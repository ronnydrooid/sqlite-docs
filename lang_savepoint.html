<!DOCTYPE html>
<html><head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link href="sqlite.css" rel="stylesheet">
<title>Savepoints</title>
<!-- path= -->
</head>
<body>
<div class=nosearch>
<a href="index.html">
<img class="logo" src="images/sqlite370_banner.svg" alt="SQLite" border="0">
</a>
<div><!-- IE hack to prevent disappearing logo --></div>
<div class="tagline desktoponly">
Small. Fast. Reliable.<br>Choose any three.
</div>
<div class="menu mainmenu">
<ul>
<li><a href="index.html">Home</a>
<li class='mobileonly'><a href="javascript:void(0)" onclick='toggle_div("submenu")'>Menu</a>
<li class='wideonly'><a href='about.html'>About</a>
<li class='desktoponly'><a href="docs.html">Documentation</a>
<li class='desktoponly'><a href="download.html">Download</a>
<li class='wideonly'><a href='copyright.html'>License</a>
<li class='desktoponly'><a href="support.html">Support</a>
<li class='desktoponly'><a href="prosupport.html">Purchase</a>
<li class='search' id='search_menubutton'>
<a href="javascript:void(0)" onclick='toggle_search()'>Search</a>
</ul>
</div>
<div class="menu submenu" id="submenu">
<ul>
<li><a href='about.html'>About</a>
<li><a href='docs.html'>Documentation</a>
<li><a href='download.html'>Download</a>
<li><a href='support.html'>Support</a>
<li><a href='prosupport.html'>Purchase</a>
</ul>
</div>
<div class="searchmenu" id="searchmenu">
<form method="GET" action="search">
<select name="s" id="searchtype">
<option value="d">Search Documentation</option>
<option value="c">Search Changelog</option>
</select>
<input type="text" name="q" id="searchbox" value="">
<input type="submit" value="Go">
</form>
</div>
</div>
<script>
function toggle_div(nm) {
var w = document.getElementById(nm);
if( w.style.display=="block" ){
w.style.display = "none";
}else{
w.style.display = "block";
}
}
function toggle_search() {
var w = document.getElementById("searchmenu");
if( w.style.display=="block" ){
w.style.display = "none";
} else {
w.style.display = "block";
setTimeout(function(){
document.getElementById("searchbox").focus()
}, 30);
}
}
function div_off(nm){document.getElementById(nm).style.display="none";}
window.onbeforeunload = function(e){div_off("submenu");}
/* Disable the Search feature if we are not operating from CGI, since */
/* Search is accomplished using CGI and will not work without it. */
if( !location.origin || !location.origin.match || !location.origin.match(/http/) ){
document.getElementById("search_menubutton").style.display = "none";
}
/* Used by the Hide/Show button beside syntax diagrams, to toggle the */
function hideorshow(btn,obj){
var x = document.getElementById(obj);
var b = document.getElementById(btn);
if( x.style.display!='none' ){
x.style.display = 'none';
b.innerHTML='show';
}else{
x.style.display = '';
b.innerHTML='hide';
}
return false;
}
var antiRobot = 0;
function antiRobotGo(){
if( antiRobot!=3 ) return;
antiRobot = 7;
var j = document.getElementById("mtimelink");
if(j && j.hasAttribute("data-href")) j.href=j.getAttribute("data-href");
}
function antiRobotDefense(){
document.body.onmousedown=function(){
antiRobot |= 2;
antiRobotGo();
document.body.onmousedown=null;
}
document.body.onmousemove=function(){
antiRobot |= 2;
antiRobotGo();
document.body.onmousemove=null;
}
setTimeout(function(){
antiRobot |= 1;
antiRobotGo();
}, 100)
antiRobotGo();
}
antiRobotDefense();
</script>
<div class=fancy>
<div class=nosearch>
<div class="fancy_title">
Savepoints
</div>
</div>




<h1 id="syntax"><span>1. </span>Syntax</h1>

<p><b><a href="syntax/savepoint-stmt.html">savepoint-stmt:</a></b>
<button id='xb9721ecc' onclick='hideorshow("xb9721ecc","x4076c644")'>hide</button></p>
 <div id='x4076c644' class='imgcontainer'>
 <div style="max-width:346px"><svg xmlns='http://www.w3.org/2000/svg' style='font-size:initial;' class="pikchr" viewBox="0 0 346.003 34.56" data-pikchr-date="20250319161943">
<circle cx="5.76" cy="17.28" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32.4,17.28 20.88,21.6 20.88,12.96" style="fill:rgb(0,0,0)"/>
<path d="M9.36,17.28L26.64,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M47.52,32.4L131.789,32.4A15.12 15.12 0 0 0 146.909 17.28A15.12 15.12 0 0 0 131.789 2.16L47.52,2.16A15.12 15.12 0 0 0 32.4 17.28A15.12 15.12 0 0 0 47.52 32.4Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="89.6544" y="17.28" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SAVEPOINT</text>
<polygon points="169.949,17.28 158.429,21.6 158.429,12.96" style="fill:rgb(0,0,0)"/>
<path d="M146.909,17.28L164.189,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M185.069,32.4L298.483,32.4A15.12 15.12 0 0 0 313.603 17.28A15.12 15.12 0 0 0 298.483 2.16L185.069,2.16A15.12 15.12 0 0 0 169.949 17.28A15.12 15.12 0 0 0 185.069 32.4Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="241.776" y="17.28" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">savepoint-name</text>
<polygon points="336.643,17.28 325.123,21.6 325.123,12.96" style="fill:rgb(0,0,0)"/>
<path d="M313.603,17.28L330.883,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="340.243" cy="17.28" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>
<p><b><a href="syntax/release-stmt.html">release-stmt:</a></b>
<button id='xa254d5c5' onclick='hideorshow("xa254d5c5","x9bcd8b3e")'>hide</button></p>
 <div id='x9bcd8b3e' class='imgcontainer'>
 <div style="max-width:488px"><svg xmlns='http://www.w3.org/2000/svg' style='font-size:initial;' class="pikchr" viewBox="0 0 488.736 54" data-pikchr-date="20250319161943">
<circle cx="5.76" cy="17.28" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32.4,17.28 20.88,21.6 20.88,12.96" style="fill:rgb(0,0,0)"/>
<path d="M9.36,17.28L26.64,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M47.52,32.4L111.053,32.4A15.12 15.12 0 0 0 126.173 17.28A15.12 15.12 0 0 0 111.053 2.16L47.52,2.16A15.12 15.12 0 0 0 32.4 17.28A15.12 15.12 0 0 0 47.52 32.4Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="79.2864" y="17.28" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">RELEASE</text>
<polygon points="162.173,17.28 150.653,21.6 150.653,12.96" style="fill:rgb(0,0,0)"/>
<path d="M126.173,17.28L156.413,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M177.293,32.4L261.562,32.4A15.12 15.12 0 0 0 276.682 17.28A15.12 15.12 0 0 0 261.562 2.16L177.293,2.16A15.12 15.12 0 0 0 162.173 17.28A15.12 15.12 0 0 0 177.293 32.4Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="219.427" y="17.28" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SAVEPOINT</text>
<polygon points="312.682,17.28 301.162,21.6 301.162,12.96" style="fill:rgb(0,0,0)"/>
<path d="M276.682,17.28L306.922,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M327.802,32.4L441.216,32.4A15.12 15.12 0 0 0 456.336 17.28A15.12 15.12 0 0 0 441.216 2.16L327.802,2.16A15.12 15.12 0 0 0 312.682 17.28A15.12 15.12 0 0 0 327.802 32.4Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="384.509" y="17.28" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">savepoint-name</text>
<polygon points="479.376,17.28 467.856,21.6 467.856,12.96" style="fill:rgb(0,0,0)"/>
<path d="M456.336,17.28L473.616,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="482.976" cy="17.28" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="219.427,47.52 207.907,51.84 207.907,43.2" style="fill:rgb(0,0,0)"/>
<path d="M126.173,17.28 L 133.673,17.28 Q 141.173,17.28 141.173,32.28 L 141.173,32.52 Q 141.173,47.52 156.173,47.52 L 198.667,47.52 L 213.667,47.52"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M219.427,47.52 L 276.682,47.52 Q 291.682,47.52 291.682,32.52 L 291.682,32.28 Q 291.682,17.28 299.182,17.28 L 306.682,17.28"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>
<p><b><a href="syntax/rollback-stmt.html">rollback-stmt:</a></b>
<button id='xca7d6da2' onclick='hideorshow("xca7d6da2","x9b810f3e")'>hide</button></p>
 <div id='x9b810f3e' class='imgcontainer'>
 <div style="max-width:801px"><svg xmlns='http://www.w3.org/2000/svg' style='font-size:initial;' class="pikchr" viewBox="0 0 801.734 67.392" data-pikchr-date="20250319161943">
<circle cx="5.76" cy="33.696" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32.4,33.696 20.88,38.016 20.88,29.376" style="fill:rgb(0,0,0)"/>
<path d="M9.36,33.696L26.64,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M47.52,48.816L125.107,48.816A15.12 15.12 0 0 0 140.227 33.696A15.12 15.12 0 0 0 125.107 18.576L47.52,18.576A15.12 15.12 0 0 0 32.4 33.696A15.12 15.12 0 0 0 47.52 48.816Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="86.3136" y="33.696" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ROLLBACK</text>
<polygon points="176.227,33.696 164.707,38.016 164.707,29.376" style="fill:rgb(0,0,0)"/>
<path d="M140.227,33.696L170.467,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M191.347,48.816L303.149,48.816A15.12 15.12 0 0 0 318.269 33.696A15.12 15.12 0 0 0 303.149 18.576L191.347,18.576A15.12 15.12 0 0 0 176.227 33.696A15.12 15.12 0 0 0 191.347 48.816Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="247.248" y="33.696" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TRANSACTION</text>
<polygon points="390.269,33.696 378.749,38.016 378.749,29.376" style="fill:rgb(0,0,0)"/>
<path d="M318.269,33.696L384.509,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M405.389,48.816L411.091,48.816A15.12 15.12 0 0 0 426.211 33.696A15.12 15.12 0 0 0 411.091 18.576L405.389,18.576A15.12 15.12 0 0 0 390.269 33.696A15.12 15.12 0 0 0 405.389 48.816Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="408.24" y="33.696" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TO</text>
<polygon points="462.211,33.696 450.691,38.016 450.691,29.376" style="fill:rgb(0,0,0)"/>
<path d="M426.211,33.696L456.451,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M477.331,48.816L561.6,48.816A15.12 15.12 0 0 0 576.72 33.696A15.12 15.12 0 0 0 561.6 18.576L477.331,18.576A15.12 15.12 0 0 0 462.211 33.696A15.12 15.12 0 0 0 477.331 48.816Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="519.466" y="33.696" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SAVEPOINT</text>
<polygon points="612.72,33.696 601.2,38.016 601.2,29.376" style="fill:rgb(0,0,0)"/>
<path d="M576.72,33.696L606.96,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M627.84,48.816L741.254,48.816A15.12 15.12 0 0 0 756.374 33.696A15.12 15.12 0 0 0 741.254 18.576L627.84,18.576A15.12 15.12 0 0 0 612.72 33.696A15.12 15.12 0 0 0 627.84 48.816Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="684.547" y="33.696" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">savepoint-name</text>
<polygon points="792.374,33.696 780.854,38.016 780.854,29.376" style="fill:rgb(0,0,0)"/>
<path d="M756.374,33.696L786.614,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="795.974" cy="33.696" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="519.466,6.48 507.946,10.8 507.946,2.16" style="fill:rgb(0,0,0)"/>
<path d="M426.211,33.696 L 433.711,33.696 Q 441.211,33.696 441.211,20.088 Q 441.211,6.48 456.211,6.48 L 498.706,6.48 L 513.706,6.48"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M519.466,6.48 L 576.72,6.48 Q 591.72,6.48 591.72,20.088 Q 591.72,33.696 599.22,33.696 L 606.72,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="519.466,60.912 507.946,65.232 507.946,56.592" style="fill:rgb(0,0,0)"/>
<path d="M352.229,33.696 L 359.729,33.696 Q 367.229,33.696 367.229,47.304 Q 367.229,60.912 382.229,60.912 L 498.706,60.912 L 513.706,60.912"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M519.466,60.912 L 756.374,60.912 Q 771.374,60.912 771.374,47.304 Q 771.374,33.696 778.874,33.696 L 786.374,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="247.248,60.912 235.728,65.232 235.728,56.592" style="fill:rgb(0,0,0)"/>
<path d="M140.227,33.696 L 147.727,33.696 Q 155.227,33.696 155.227,47.304 Q 155.227,60.912 170.227,60.912 L 226.488,60.912 L 241.488,60.912"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M247.248,60.912 L 318.269,60.912 Q 333.269,60.912 333.269,47.304 Q 333.269,33.696 340.769,33.696 L 348.269,33.696"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>


<h1 id="savepoints"><span>2. </span>Savepoints</h1>

<p> SAVEPOINTs are a method of creating transactions, similar to
<a href="lang_transaction.html">BEGIN</a> and <a href="lang_transaction.html">COMMIT</a>, except that the SAVEPOINT and RELEASE commands
are named and may be nested.</p>

<p> The SAVEPOINT command starts a new transaction with a name.
The transaction names need not be unique.
A SAVEPOINT can be started either within or outside of
a <a href="lang_transaction.html">BEGIN</a>...<a href="lang_transaction.html">COMMIT</a>.  When a SAVEPOINT is the outer-most savepoint
and it is not within a <a href="lang_transaction.html">BEGIN</a>...<a href="lang_transaction.html">COMMIT</a> then the behavior is the
same as BEGIN DEFERRED TRANSACTION.</p>

<p>The ROLLBACK TO command reverts the state of the database back to what
it was just after the corresponding SAVEPOINT.  Note that unlike that
plain <a href="lang_transaction.html">ROLLBACK</a> command (without the TO keyword) the ROLLBACK TO command
does not cancel the transaction.  Instead of cancelling the transaction,
the ROLLBACK TO command restarts the transaction again at the beginning.
All intervening SAVEPOINTs are canceled, however.</p>

<p>The RELEASE command is like a <a href="lang_transaction.html">COMMIT</a> for a SAVEPOINT.
The RELEASE command causes all savepoints back to and including the 
most recent savepoint with a matching name to be removed from the 
transaction stack.  The RELEASE of an inner transaction
does not cause any changes to be written to the database file; it merely
removes savepoints from the transaction stack such that it is
no longer possible to ROLLBACK TO those savepoints.
If a RELEASE command releases the outermost savepoint, so
that the transaction stack becomes empty, then RELEASE is the same
as <a href="lang_transaction.html">COMMIT</a>.
The <a href="lang_transaction.html">COMMIT</a> command may be used to release all savepoints and
commit the transaction even if the transaction was originally started
by a SAVEPOINT command instead of a <a href="lang_transaction.html">BEGIN</a> command.</p>

<p>If the savepoint-name in a RELEASE command does not match any
savepoint currently in the transaction stack, then no savepoints are
released, the database is unchanged, and the RELEASE command returns
an error.</p>

<p>Note that an inner transaction might commit (using the RELEASE command)
but then later have its work undone by a ROLLBACK in an outer transaction.
A power failure or program crash or OS crash will cause the outer-most
transaction to rollback, undoing all changes that have occurred within
that outer transaction, even changes that have supposedly been "committed"
by the RELEASE command.  Content is not actually committed on the disk 
until the outermost transaction commits.</p>

<p>There are several ways of thinking about the RELEASE command:</p>

<ul>
<li><p>
Some people view RELEASE as the equivalent of COMMIT for a SAVEPOINT.
This is an acceptable point of view as long as one remembers that the
changes committed by an inner transaction might later be undone by a
rollback in an outer transaction.</p></li>

<li><p>
Another view of RELEASE is that it merges a named transaction into its
parent transaction, so that the named transaction and its parent become
the same transaction.  After RELEASE, the named transaction and its parent
will commit or rollback together, whatever their fate may be.
</p></li>

<li><p>
One can also think of savepoints as
"marks" in the transaction timeline.  In this view, the SAVEPOINT command
creates a new mark, the ROLLBACK TO command rewinds the timeline back
to a point just after the named mark, and the RELEASE command
erases marks from the timeline without actually making any
changes to the database.
</p></li>
</ul>



<h1 id="transaction_nesting_rules"><span>3. </span>Transaction Nesting Rules</h1>

<p>The last transaction started will be the first
transaction committed or rolled back.</p>

<p>The <a href="lang_transaction.html">BEGIN</a> command only works if the transaction stack is empty, or
in other words if there are no pending transactions.  If the transaction
stack is not empty when the <a href="lang_transaction.html">BEGIN</a> command is invoked, then the command
fails with an error.</p>

<p>The <a href="lang_transaction.html">COMMIT</a> command commits all outstanding transactions and leaves
the transaction stack empty.</p>

<p>The RELEASE command starts with the most recent addition to the
transaction stack and releases savepoints backwards 
in time until it releases a savepoint with a matching savepoint-name.
Prior savepoints, even savepoints with matching savepoint-names, are
unchanged.
If the RELEASE command causes the
transaction stack to become empty (if the RELEASE command releases the
outermost transaction from the stack) then the transaction commits.</p>

<p>The <a href="lang_transaction.html">ROLLBACK</a> command without a TO clause rolls backs all transactions
and leaves the transaction stack empty.</p>

<p>The ROLLBACK command with a TO clause rolls back transactions going
backwards in time back to the most recent SAVEPOINT with a matching name.
The SAVEPOINT with the matching name remains on the transaction stack,
but all database changes that occurred after that SAVEPOINT was created
are rolled back.  If the savepoint-name in a ROLLBACK TO command does not
match any SAVEPOINT on the stack, then the ROLLBACK command fails with an
error and leaves the state of the database unchanged.</p>
<p align="center"><small><i>This page last modified on  <a href="https://sqlite.org/docsrc/honeypot" id="mtimelink"  data-href="https://sqlite.org/docsrc/finfo/pages/lang_savepoint.in?m=60d80524de">2022-01-08 05:02:57</a> UTC </small></i></p>

